use vars qw($data $flat_data);

$data =
{
	'x' => 1,
	'y' => {
		'a' => 2,
		'b' => {
			'p' => 3,
			'q' => 4
		},
	}
};

$flat_data = {
          'x' => 1,
          'y.a' => 2,
          'y.b.p' => 3,
          'y.b.q' => 4
        };